<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:head>
        <title>Facelet Title</title>
    </h:head>
    <h:body>


        <ui:composition template="./WEB-INF/template/plantilla.xhtml">
            <ui:define name="content">
                <f:event type="preRenderView" listener="#{grupoBean.listarInicio()}" />
                
                <p:dialog modal="true" widgetVar="statusDialogGrupo" header="Cargando..." draggable="false" closable="false" resizable="false">
                    <p:graphicImage value="/resources/imagen/cargando.gif"  width="80" height="80"/>
                </p:dialog>
                <script type="text/javascript">
                    function start() {
                        PF('statusDialogGrupo').show();
                    }
                    function stop() {
                        PF('statusDialogGrupo').hide();
                    }
                </script>

                <div id="miga">
                    <h:form>
                        <p:breadCrumb> 
                            <p:menuitem value="Campeonatos" action="#{campeonatoBean.listarInicio()}"/>     
                            <p:menuitem value="#{grupoBean.campeonato.nombreCampeonato}"  action="#{campeonatoBean.verGruposCampeonato(grupoBean.campeonato)}"/>   
                        </p:breadCrumb>
                    </h:form>
                </div> 


                <div> 
                    <h:form >

                        <p:commandLink value="Inicio  " action="listaCampeonato?faces-redirect=true" style="text-decoration: none"/>
                        <p:commandLink value="#{grupoBean.campeonato.nombreCampeonato}" action="listaGrupo?faces-redirect=true" style="text-decoration: none"/>

                    </h:form>
                </div>
                <p:tabView id="idTabviewVistaCampeonato">
                    
                     <p:tab title="Jornadas" id="tab2">
                         
                        <h:panelGrid columns="2" cellpadding="10" id="panel2">
                            <h:form id="formJornadas">
                                <p:commandButton value="Nueva Jornada" oncomplete="PF('wdgJornada').show();"
                                                 actionListener="#{grupoBean.setAccion('Registrar')}"
                                                  update=":dlgJornada" />
                                
                                <p:dataTable id="data" value="#{grupoBean.listaJornada}" var="jor"
                                             rowKey="#{jor.idJornada}"
                                             expandedRow="#{jor.idJornada == grupoBean.rowSelJor}"
                                             >
                                     <p:column style="width:50px">
                                        <p:rowToggler />
                                    </p:column>
                                    <p:column headerText="jornada">
                                        <p:outputLabel value="#{jor.nombreJornada}"/>
                                    </p:column>
                                    <p:column headerText="new">
                                        <p:commandButton value="Agregar Partido" oncomplete="PF('wdgAddParJor').show();"
                                                         actionListener="#{grupoBean.setJornada(jor)}"
                                                  update=":dlgAddParJor" />
                                    </p:column>

                                    <p:rowExpansion>
                                       
                                        <p:panelGrid  columns="1" columnClasses="label,value" style="width:900px">
                                            <f:facet name="header">
                                               
                                            </f:facet>
                                            <p:dataTable id="idTableParJor" var="parJor" value="#{grupoBean.listarPartidosJornada(jor)}" style=" align-content:  center" 
                                                         rowKey="#{parJor.idPartido}"
                                                         selection="#{grupoBean.partidoSelecJor}" selectionMode="single">
                                                <p:column width="30%">
                                                    <p:outputLabel value="#{parJor.idGrupo}"/>
                                                </p:column>
                                                <p:column width="30%">
                                                    <p:outputLabel value="#{parJor.equipoA.nombreEquipo}"/>
                                                </p:column>
                                                <p:column width="30%">
                                                    <p:outputLabel value="#{parJor.golA} - #{parJor.golB}"/>
                                                </p:column>
                                                <p:column width="30%">
                                                    <p:outputLabel value="#{parJor.equipoB.nombreEquipo}"/>
                                                </p:column>
                                            </p:dataTable>
                                            <p:contextMenu for="idTableParJor">
                                                <p:menuitem value="View"  icon="ui-icon-search" oncomplete="PF('DlgConfirmDeleteParJor').show();"/>     
                                                <p:menuitem value="Delete"  icon="ui-icon-close" actionListener="#"/>
                                            </p:contextMenu>
                                         
                                        </p:panelGrid>
                                    </p:rowExpansion>
                                </p:dataTable>
                                 <p:confirmDialog widgetVar="DlgConfirmDeleteParJor" global="true" showEffect="fade" hideEffect="fade" styleClass="customTitleDialogBar">
                                                    <p:commandButton value="yes" type="button" styleClass="ui-confirmdialog-yes customButtonAdd" icon="fa fa-check" style="float: right"/>
                                                    <p:commandButton  value="no" type="button" styleClass="ui-confirmdialog-no customButtonAdd" icon="fa fa-times" style="float: left"/>
                                </p:confirmDialog>
                            </h:form>
                        </h:panelGrid>
                    </p:tab>

                    <p:tab title="Grupos">
                        <h:panelGrid columns="2" cellpadding="10">

                            <h:form id="formGrupos">
                                <p:panel id="basic" header="#{grupoBean.campeonato.nombreCampeonato}" >
                                    <p:dataGrid var="grupo" value="#{grupoBean.listaGrupo}" columns="5">

                                        <p:panelGrid columns="1" style=" align-content:  center">

                                            <f:facet name="header">

                                                <p:commandButton   value="#{grupo.nombreGrupo}" action="#{grupoBean.verGrupo(grupo)}" 
                                                                    onclick="PrimeFaces.monitorDownload(start, stop);"
                                                                   title="Ver Equipos del Grupo"
                                                                   />
                                            </f:facet>
                                            <p:dataTable var="equi" value="#{grupoBean.getListaEquipos(grupo)}" style=" align-content:  center">
                                                <p:column width="30%">
                                                    <p:outputLabel value="#{equi.nombreEquipo}"/>
                                                </p:column>
                                            </p:dataTable>


                                        </p:panelGrid>

                                    </p:dataGrid>
                                </p:panel>
                            </h:form> 
                        </h:panelGrid>
                    </p:tab>
                    
                    <p:tab title="Goleadores" id="tab1">
                        <h:panelGrid columns="2" cellpadding="10" id="panel1">
                            <h:form id="frm1">
                                <p:outputLabel value="#{grupoBean.campeonato.nombreCampeonato}/"/>
                                <p:dataTable id="data" value="#{grupoBean.listaGoleadores}" var="goleador" 
                                             rows="5" paginator="true"
                                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             rowsPerPageTemplate="5,10,15" paginatorPosition="bottom" 
                                             reflow="true"
                                             >
                                    <p:column headerText="pos">
                                        <p:outputLabel value="#{grupoBean.listaGoleadores.indexOf(goleador)+1}"/>
                                    </p:column>
                                    <p:column headerText="Jugador">
                                        <p:outputLabel value="#{goleador.nombreJugador}"/>
                                    </p:column>
                                    <p:column headerText="id equ">
                                        <p:outputLabel value="#{goleador.idEquipoJugador}"/>
                                    </p:column> 
                                    <p:column headerText="Goles">
                                        <p:outputLabel value="#{goleador.numGol}"/>
                                    </p:column>
                                    <p:column headerText="Ver">
                                        <p:commandLink id="linkVPartidos" value="Ver" action="#{grupoBean.verGrupo(grup)}"  update="data" 
                                                       ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);"
                                                       />

                                    </p:column>

                                </p:dataTable>
                            </h:form>
                        </h:panelGrid>
                    </p:tab>
                    

                </p:tabView>

                <p:dialog header="Registrar o Modificar Grupos" widgetVar="wdgDatos" id="dlgDatos">
                    <h:form>
                        <p:growl autoUpdate="true" showDetail="true"/>
                        <p:outputLabel value="Nombre Grupo" for="txtNombre"/>
                        <p:inputText id="txtNombre" required="true" value="#{grupoBean.grupo.nombreGrupo}"/>

                        <p:commandButton value="#{grupoBean.accion}"  actionListener="#{grupoBean.operar()}" oncomplete="PF('wdgDatos').hide();" />
                        <p:commandButton value="Cancelar"  immediate="True" oncomplete="PF('wdgDatos').hide();"/> 
                    </h:form>
                </p:dialog>
                
                <p:dialog header="Registrar o Modificar Jornada" widgetVar="wdgJornada" id="dlgJornada">
                    <h:form>
                        <p:growl autoUpdate="true" showDetail="true"/>
                        <p:outputLabel value="Nombre Jornada" for="txtJornada"/>
                        <p:inputText id="txtJornada" required="true" value="#{grupoBean.jornada.nombreJornada}"/>

                        <p:commandButton value="crear nuevo"  actionListener="#{grupoBean.operarJornada()}"
                                         oncomplete="PF('wdgJornada').hide();"
                                         update="idTabviewVistaCampeonato:formJornadas, idTabviewVistaCampeonato:formGrupos"
                                         />
                        <p:commandButton value="Cancelar"  immediate="True" oncomplete="PF('wdgJornada').hide();"/> 
                    </h:form>
                </p:dialog>
                
                <p:dialog header="Agregar Partido a la Jornada" widgetVar="wdgAddParJor" id="dlgAddParJor">
                    <h:form>
                        <p:growl autoUpdate="true" showDetail="true"/>
                        <p:outputLabel value="Grupo:"/>
                        <p:selectOneMenu  value="#{grupoBean.itemGrupoSelected}">
                            <f:selectItem itemLabel="--Seleccione--" itemValue=""/>
                            <f:selectItems value="#{grupoBean.selectItemOneGrupos}"/>
                            <p:ajax update="selPartido"/>
                        </p:selectOneMenu>
                        
                        <p:outputLabel value="Partido" />
                        <p:selectOneMenu id="selPartido" value="#{grupoBean.itemPartidoSelected}" >
                            <f:selectItem itemLabel="--Seleccione--" itemValue=""/>
                            <f:selectItems value="#{grupoBean.selectItemOnePartidos}"/>
                            
                        </p:selectOneMenu>
                        

                        <p:commandButton value="Agregar"  actionListener="#{grupoBean.agregarPartidoJornada()}"
                                         oncomplete="PF('wdgAddParJor').hide();"
                                         update="idTabviewVistaCampeonato:formJornadas, idTabviewVistaCampeonato:formGrupos"
                                         />
                        <p:commandButton value="Cancelar"  immediate="True" oncomplete="PF('wdgAddParJor').hide();"/> 
                    </h:form>
                </p:dialog>

            </ui:define>           
        </ui:composition>

    </h:body>
</html>

